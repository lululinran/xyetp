# 校园二手交易网站 - 功能保留建议和部署指南

## 📋 功能保留建议

### ✅ **必须保留的核心功能（MVP - 最小可行产品）**

#### **前台用户系统**

1. **用户认证模块** ⭐⭐⭐
   - 用户注册
   - 用户登录
   - 找回密码（可选，可简化）
   - 用户信息管理
   - 头像上传

2. **商品展示模块** ⭐⭐⭐
   - 首页商品列表（按时间排序）
   - 商品分类浏览
   - 商品详情页
   - 商品搜索功能

3. **商品发布模块** ⭐⭐⭐
   - 发布闲置商品
   - 上传商品图片（至少1张）
   - 管理我发布的商品（查看、编辑、删除）

4. **订单管理模块** ⭐⭐⭐
   - 创建订单
   - 订单确认
   - 模拟支付（简化版）
   - 查看我的订单（购买/出售）

5. **地址管理模块** ⭐⭐
   - 添加收货地址
   - 编辑/删除地址
   - 设置默认地址

#### **后台管理系统**

1. **管理员登录** ⭐⭐⭐
2. **商品管理** ⭐⭐⭐
   - 查看所有商品
   - 商品上架/下架
   - 删除商品
3. **分类管理** ⭐⭐⭐
   - 添加分类
   - 编辑分类
   - 删除分类
4. **订单管理** ⭐⭐
   - 查看所有订单
   - 订单状态管理

### ⚠️ **可以简化或删除的功能**

1. **轮播图管理** - 可以删除，首页直接显示商品列表
2. **留言/评论功能** - 可以简化，只保留基本留言
3. **举报功能** - 可以删除，后台直接处理
4. **"想要"功能** - 可以删除，只保留购买功能
5. **累计收入/支出统计** - 可以删除，简化用户中心
6. **二维码支付** - 可以简化为普通支付按钮
7. **城市选择功能** - 可以删除或固定为校园地址
8. **Excel导入导出** - 可以删除
9. **Druid监控** - 可以删除（开发阶段可保留）

### 📊 **功能优先级总结**

| 功能模块 | 优先级 | 建议 |
|---------|--------|------|
| 用户注册/登录 | ⭐⭐⭐ | 必须保留 |
| 商品发布 | ⭐⭐⭐ | 必须保留 |
| 商品浏览/搜索 | ⭐⭐⭐ | 必须保留 |
| 订单管理 | ⭐⭐⭐ | 必须保留 |
| 地址管理 | ⭐⭐ | 建议保留 |
| 后台管理 | ⭐⭐⭐ | 必须保留 |
| 留言功能 | ⭐ | 可简化 |
| 轮播图 | ⭐ | 可删除 |
| 举报功能 | ⭐ | 可删除 |
| 统计功能 | ⭐ | 可删除 |

---

## 🚀 部署指南

### **方式一：本地开发环境部署（推荐用于开发测试）**

#### **环境准备**

1. **JDK 1.8**
   ```bash
   # 检查JDK版本
   java -version
   ```

2. **Maven 3.5+**
   ```bash
   # 检查Maven版本
   mvn -version
   ```

3. **MySQL 5.7+**
   ```bash
   # 检查MySQL版本
   mysql --version
   ```

4. **Tomcat 8/8.5**
   - 下载地址：https://tomcat.apache.org/download-80.cgi
   - 解压到本地目录

#### **部署步骤**

**1. 数据库配置**

```bash
# 1. 创建数据库
mysql -u root -p
CREATE DATABASE market CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
exit;

# 2. 导入SQL文件
mysql -u root -p market < src/main/resources/market.sql
```

**2. 修改数据库连接配置**

编辑 `src/main/resources/jdbc.properties`：
```properties
driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/market?useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true&serverTimezone=UTC
username=root
password=你的MySQL密码
```

**3. 配置项目**

- 在IDEA中打开项目
- 右键 `src/main/resources` 目录 → Mark Directory as → Resources Root
- 配置Maven：File → Settings → Build → Build Tools → Maven

**4. 编译项目**

```bash
# 在项目根目录执行
mvn clean compile
```

**5. 打包项目**

```bash
mvn clean package
# 生成的war包在 target/kd-second-hand-workshop.war
```

**6. 部署到Tomcat**

**方法A：IDEA直接运行**
- Run → Edit Configurations
- 添加Tomcat Server（Local）
- Deployment添加artifact: `kd-second-hand-workshop:war exploded`
- 设置Application context: `/`
- 端口设置为8088

**方法B：手动部署**
```bash
# 1. 复制war包到Tomcat的webapps目录
cp target/kd-second-hand-workshop.war /path/to/tomcat/webapps/

# 2. 启动Tomcat
cd /path/to/tomcat/bin
./startup.sh  # Linux/Mac
startup.bat   # Windows

# 3. 访问
http://localhost:8088/goods/index
```

**7. 配置图片上传路径**

确保图片上传目录存在且可写：
```bash
# 项目运行后，图片会保存在webapp目录下
# 需要确保该目录有写权限
```

---

### **方式二：云服务器部署（用于演示和提交）**

#### **推荐平台**
- 阿里云ECS
- 腾讯云CVM
- 华为云ECS
- 学生优惠：阿里云/腾讯云都有学生机（约10元/月）

#### **服务器配置要求**
- CPU: 1核
- 内存: 2GB
- 系统: CentOS 7 / Ubuntu 18.04+
- 带宽: 1Mbps+

#### **部署步骤**

**1. 连接服务器**
```bash
ssh root@你的服务器IP
```

**2. 安装JDK 1.8**
```bash
# CentOS
yum install java-1.8.0-openjdk java-1.8.0-openjdk-devel

# Ubuntu
apt-get update
apt-get install openjdk-8-jdk

# 验证
java -version
```

**3. 安装Maven**
```bash
# 下载Maven
cd /opt
wget https://archive.apache.org/dist/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz
tar -xzf apache-maven-3.6.3-bin.tar.gz
mv apache-maven-3.6.3 maven

# 配置环境变量
echo 'export M2_HOME=/opt/maven' >> /etc/profile
echo 'export PATH=$PATH:$M2_HOME/bin' >> /etc/profile
source /etc/profile

# 验证
mvn -version
```

**4. 安装MySQL**
```bash
# CentOS
yum install mysql-server
systemctl start mysqld
systemctl enable mysqld

# Ubuntu
apt-get install mysql-server
systemctl start mysql
systemctl enable mysql

# 设置root密码
mysql_secure_installation
```

**5. 安装Tomcat**
```bash
cd /opt
wget https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.78/bin/apache-tomcat-8.5.78.tar.gz
tar -xzf apache-tomcat-8.5.78.tar.gz
mv apache-tomcat-8.5.78 tomcat8

# 配置环境变量（可选）
echo 'export CATALINA_HOME=/opt/tomcat8' >> /etc/profile
source /etc/profile
```

**6. 上传项目到服务器**
```bash
# 方法1：使用scp
scp -r kd-second-hand-workshop-master root@服务器IP:/opt/

# 方法2：使用git（推荐）
# 在服务器上
cd /opt
git clone 你的项目地址
```

**7. 配置数据库**
```bash
# 创建数据库
mysql -u root -p
CREATE DATABASE market CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
exit;

# 导入SQL
mysql -u root -p market < /opt/kd-second-hand-workshop-master/src/main/resources/market.sql
```

**8. 修改配置文件**
```bash
# 修改数据库连接
vim /opt/kd-second-hand-workshop-master/src/main/resources/jdbc.properties
# 修改为服务器MySQL的配置
```

**9. 编译打包**
```bash
cd /opt/kd-second-hand-workshop-master
mvn clean package
```

**10. 部署到Tomcat**
```bash
# 停止Tomcat（如果运行中）
/opt/tomcat8/bin/shutdown.sh

# 删除旧部署
rm -rf /opt/tomcat8/webapps/kd-second-hand-workshop*

# 复制war包
cp target/kd-second-hand-workshop.war /opt/tomcat8/webapps/

# 启动Tomcat
/opt/tomcat8/bin/startup.sh

# 查看日志
tail -f /opt/tomcat8/logs/catalina.out
```

**11. 配置防火墙**
```bash
# CentOS 7
firewall-cmd --permanent --add-port=8088/tcp
firewall-cmd --reload

# Ubuntu
ufw allow 8088/tcp
```

**12. 访问测试**
```
http://你的服务器IP:8088/goods/index
```

---

### **方式三：Docker部署（可选，更现代化）**

如果需要，我可以帮你创建Dockerfile和docker-compose.yml文件。

---

## 🔧 常见问题解决

### **1. 项目启动404错误**
- 检查web.xml配置
- 确认resources目录已标记为Resources Root
- 检查Tomcat端口是否为8088

### **2. 数据库连接失败**
- 检查jdbc.properties配置
- 确认MySQL服务已启动
- 检查数据库用户权限

### **3. 图片上传失败**
- 检查上传目录权限
- 确认文件大小限制配置
- 检查磁盘空间

### **4. 中文乱码**
- 确认数据库字符集为utf8mb4
- 检查web.xml中的编码过滤器
- 确认JSP页面编码为UTF-8

---

## 📝 项目简化建议清单

### **可以删除的文件/功能**

1. **控制器层**
   - `CaptcheController.java` - 验证码（可简化）
   - `DictController.java` - 城市字典（可删除）

2. **服务层**
   - 删除与"想要"功能相关的服务
   - 删除Excel导出相关服务

3. **前端页面**
   - 简化用户中心页面
   - 删除轮播图管理页面
   - 简化支付页面（去掉二维码）

4. **数据库表**
   - `wanted` 表（如果删除想要功能）
   - `report` 表（如果删除举报功能）
   - `carousel` 表（如果删除轮播图）

---

## 🎯 快速开始检查清单

- [ ] JDK 1.8 已安装
- [ ] Maven 已安装并配置
- [ ] MySQL 已安装并运行
- [ ] 数据库已创建并导入SQL
- [ ] jdbc.properties 已配置
- [ ] Tomcat 8/8.5 已安装
- [ ] 项目已编译打包
- [ ] 项目已部署到Tomcat
- [ ] 可以访问 http://localhost:8088/goods/index
- [ ] 可以登录测试账号

---

## 📞 需要帮助？

如果在部署过程中遇到问题，可以：
1. 查看Tomcat日志：`logs/catalina.out`
2. 查看项目日志：`logs/` 目录
3. 检查数据库连接：使用Navicat或命令行测试

祝你的软件工程大作业顺利完成！🎉

---

## 🧭 Mac 本地快速部署（Homebrew Tomcat@9，端口 8088，小白向）
1. 编译打包：`mvn -DskipTests package`
2. 停 Tomcat：`/opt/homebrew/opt/tomcat@9/bin/catalina stop`
3. 部署 WAR：`cp target/kd-second-hand-workshop.war /opt/homebrew/opt/tomcat@9/libexec/webapps/ROOT.war`
4. 删旧解压：`rm -rf /opt/homebrew/opt/tomcat@9/libexec/webapps/ROOT`
5. 启动 Tomcat：`/opt/homebrew/opt/tomcat@9/bin/catalina start`
6. 访问首页：http://localhost:8088/
7. 图片：把图片文件放到 `/opt/homebrew/opt/tomcat@9/libexec/webapps/ROOT/images/web`，页面访问 `/assets/web/文件名`；数据库 `image.img_url` 只填文件名。
8. 分类：发布页会自动初始化默认分类（含“其他”）。

## 🛠 常见错误与解决
- **端口被占或停不掉**：`lsof -nP -i tcp:8088` 找到 java PID，`kill <PID>` 后再启动。
- **图片 404**：硬刷新；确认文件在 `webapps/ROOT/images/web`；数据库只存文件名；访问路径用 `/assets/web/文件名`。
- **分类下拉为空**：程序会自动补默认分类（含“其他”）；若未生成，在 MySQL `catelog` 表插入 `name='其他', status=1`。
- **样式没变**：Ctrl/Cmd+Shift+R 清缓存；或重新部署最新 WAR 并删除旧的 ROOT 目录。
- **连不上数据库**：检查 `src/main/resources/jdbc.properties` 的 URL、用户名、密码（默认 root 无密码），改完重启 Tomcat。
